<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API –¶–£–ü–∫–æ–∏–Ω—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #012C6D;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #012C6D;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #234567;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –¶–£–ü–∫–æ–∏–Ω—ã</h1>
        
        <div class="test-section">
            <h2>1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <input type="email" id="email" placeholder="Email" value="admin@tcyp.ru">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" value="password123">
            <button onclick="login()">–í–æ–π—Ç–∏</button>
            <div id="loginResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞</h2>
            <button onclick="checkToken()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <div id="tokenResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>3. –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</h2>
            <button onclick="getStats()">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button onclick="getLeaderboard()">–†–µ–π—Ç–∏–Ω–≥</button>
            <div id="statsResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>4. –ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏</h2>
            <button onclick="getEmployees()">–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</button>
            <button onclick="getPendingRequests()">–û–∂–∏–¥–∞—é—â–∏–µ –∑–∞—è–≤–∫–∏</button>
            <div id="adminResult" class="result"></div>
        </div>
    </div>

    <script>
        let authToken = '';

        async function apiCall(method, url, body = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            if (authToken) {
                options.headers['Authorization'] = `Bearer ${authToken}`;
            }

            if (body) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(`http://localhost:3000${url}`, options);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || '–û—à–∏–±–∫–∞ API');
                }
                
                return { success: true, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            const result = await apiCall('POST', '/api/auth/login', { email, password });
            
            if (result.success) {
                authToken = result.data.token;
                document.getElementById('loginResult').className = 'result success';
                document.getElementById('loginResult').textContent = 
                    `‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${result.data.user.full_name}\n–†–æ–ª—å: ${result.data.user.is_admin ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫'}`;
            } else {
                document.getElementById('loginResult').className = 'result error';
                document.getElementById('loginResult').textContent = `‚ùå –û—à–∏–±–∫–∞: ${result.error}`;
            }
        }

        async function checkToken() {
            const result = await apiCall('GET', '/api/auth/me');
            
            if (result.success) {
                document.getElementById('tokenResult').className = 'result success';
                document.getElementById('tokenResult').textContent = 
                    `‚úÖ –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω!\n${JSON.stringify(result.data, null, 2)}`;
            } else {
                document.getElementById('tokenResult').className = 'result error';
                document.getElementById('tokenResult').textContent = `‚ùå –û—à–∏–±–∫–∞: ${result.error}`;
            }
        }

        async function getStats() {
            const result = await apiCall('GET', '/api/transactions/stats');
            
            if (result.success) {
                document.getElementById('statsResult').className = 'result success';
                document.getElementById('statsResult').textContent = 
                    `‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n${JSON.stringify(result.data, null, 2)}`;
            } else {
                document.getElementById('statsResult').className = 'result error';
                document.getElementById('statsResult').textContent = `‚ùå –û—à–∏–±–∫–∞: ${result.error}`;
            }
        }

        async function getLeaderboard() {
            const result = await apiCall('GET', '/api/users/leaderboard');
            
            if (result.success) {
                document.getElementById('statsResult').className = 'result success';
                document.getElementById('statsResult').textContent = 
                    `‚úÖ –†–µ–π—Ç–∏–Ω–≥:\n${JSON.stringify(result.data, null, 2)}`;
            } else {
                document.getElementById('statsResult').className = 'result error';
                document.getElementById('statsResult').textContent = `‚ùå –û—à–∏–±–∫–∞: ${result.error}`;
            }
        }

        async function getEmployees() {
            const result = await apiCall('GET', '/api/admin/employees');
            
            if (result.success) {
                document.getElementById('adminResult').className = 'result success';
                document.getElementById('adminResult').textContent = 
                    `‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏:\n${JSON.stringify(result.data, null, 2)}`;
            } else {
                document.getElementById('adminResult').className = 'result error';
                document.getElementById('adminResult').textContent = `‚ùå –û—à–∏–±–∫–∞: ${result.error}`;
            }
        }

        async function getPendingRequests() {
            const result = await apiCall('GET', '/api/admin/requests/pending');
            
            if (result.success) {
                document.getElementById('adminResult').className = 'result success';
                document.getElementById('adminResult').textContent = 
                    `‚úÖ –û–∂–∏–¥–∞—é—â–∏–µ –∑–∞—è–≤–∫–∏:\n${JSON.stringify(result.data, null, 2)}`;
            } else {
                document.getElementById('adminResult').className = 'result error';
                document.getElementById('adminResult').textContent = `‚ùå –û—à–∏–±–∫–∞: ${result.error}`;
            }
        }
    </script>
</body>
</html>